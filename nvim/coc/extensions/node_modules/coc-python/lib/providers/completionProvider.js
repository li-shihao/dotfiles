'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
const types_1 = require("../common/types");
const completionSource_1 = require("./completionSource");
const itemInfoSource_1 = require("./itemInfoSource");
class PythonCompletionItemProvider {
    constructor(jediFactory, serviceContainer) {
        this.completionSource = new completionSource_1.CompletionSource(jediFactory, serviceContainer, new itemInfoSource_1.ItemInfoSource(jediFactory));
        this.configService = serviceContainer.get(types_1.IConfigurationService);
    }
    async provideCompletionItems(document, position, token) {
        const items = await this.completionSource.getVsCodeCompletionItems(document, position, token);
        if (this.configService.isTestExecution()) {
            for (let i = 0; i < Math.min(3, items.length); i += 1) {
                items[i] = await this.resolveCompletionItem(items[i], token);
            }
        }
        return items;
    }
    async resolveCompletionItem(item, token) {
        if (!item.documentation) {
            const itemInfos = await this.completionSource.getDocumentation(item, token);
            if (itemInfos && itemInfos.length > 0) {
                let tip = itemInfos[0].tooltip;
                item.documentation = { kind: tip.kind, value: tip.value.trim() };
            }
        }
        return item;
    }
}
exports.PythonCompletionItemProvider = PythonCompletionItemProvider;
//# sourceMappingURL=completionProvider.js.map